{
  "testSuiteName": "Tempo App V2 - Data Integrity & CRUD Tests",
  "description": "Automated tests for the PHP/MySQL backend. Focuses on granular CRUD operations to ensure data safety, relationship integrity, and activity logging.",
  "environment": {
    "baseUrl": "http://localhost/api.php",
    "dbHost": "127.0.0.1",
    "testUser": "stefan",
    "testPass": "2025"
  },
  "testSequence": [
    {
      "id": "001_AUTH_LOGIN",
      "name": "Admin Login",
      "description": "Authenticate to get the session/cookie for subsequent requests.",
      "method": "POST",
      "endpoint": "?action=login",
      "headers": { "Content-Type": "application/x-www-form-urlencoded" },
      "payload": {
        "username": "stefan",
        "password": "2025"
      },
      "assertions": [
        { "type": "statusCode", "value": 200 },
        { "type": "jsonProperty", "key": "success", "value": true },
        { "type": "jsonProperty", "key": "user.role", "value": "admin" }
      ]
    },
    {
      "id": "002_CREATE_TEAM_MEMBER",
      "name": "Create Test Therapist",
      "description": "Create a specific team member to link events to.",
      "method": "POST",
      "endpoint": "?path=team-members",
      "payload": {
        "id": "tm_test_ai_01",
        "name": "AI Test Therapist",
        "role": "therapist",
        "color": "#FF0000",
        "initials": "AI"
      },
      "assertions": [
        { "type": "statusCode", "value": 200 },
        { "type": "jsonProperty", "key": "success", "value": true }
      ]
    },
    {
      "id": "003_CREATE_CLIENT",
      "name": "Create Test Client",
      "description": "Create a client record to verify persistence.",
      "method": "POST",
      "endpoint": "?path=clients",
      "payload": {
        "id": "cl_test_ai_01",
        "name": "AI Patient Zero",
        "email": "ai@tempo.test",
        "phone": "0700123456",
        "birthDate": "2020-01-01",
        "medical": "Test Medical Notes",
        "is_archived": 0
      },
      "assertions": [
        { "type": "statusCode", "value": 200 },
        { "type": "jsonProperty", "key": "success", "value": true }
      ]
    },
    {
      "id": "004_CREATE_EVENT_TYPE",
      "name": "Create Custom Event Type",
      "description": "Ensure event type validation works by creating a specific type first.",
      "method": "POST",
      "endpoint": "?path=event_types",
      "payload": {
        "id": "type_ai_test",
        "label": "AI Therapy Session",
        "isBillable": 1,
        "requiresTime": 1,
        "base_price": 150
      },
      "assertions": [
        { "type": "statusCode", "value": 200 },
        { "type": "jsonProperty", "key": "success", "value": true }
      ]
    },
    {
      "id": "005_CREATE_EVENT",
      "name": "Create Linked Event",
      "description": "Create an event linking the new Client, Therapist, and Event Type. Checks relational integrity.",
      "method": "POST",
      "endpoint": "?path=events",
      "payload": [
        {
          "id": "evt_ai_test_01",
          "name": "Initial AI Assessment",
          "type": "type_ai_test",
          "date": "2025-12-01",
          "startTime": "10:00",
          "duration": 60,
          "isPublic": 0,
          "isBillable": 1,
          "clientIds": ["cl_test_ai_01"],
          "teamMemberIds": ["tm_test_ai_01"],
          "programIds": []
        }
      ],
      "assertions": [
        { "type": "statusCode", "value": 200 },
        { "type": "jsonProperty", "key": "success", "value": true }
      ]
    },
    {
      "id": "006_READ_DATA_INTEGRITY",
      "name": "Verify Data Persistence",
      "description": "Fetch all data to ensure the Event was saved with correct relations and Time Format is HH:MM.",
      "method": "GET",
      "endpoint": "?path=data",
      "assertions": [
        { "type": "statusCode", "value": 200 },
        { "type": "arrayContains", "path": "events", "key": "id", "value": "evt_ai_test_01" },
        { "type": "nestedArrayContains", "path": "events", "finderKey": "id", "finderValue": "evt_ai_test_01", "targetArray": "clientIds", "value": "cl_test_ai_01" },
        { "type": "valueMatch", "path": "events", "finderKey": "id", "finderValue": "evt_ai_test_01", "targetKey": "startTime", "expected": "10:00" }
      ]
    },
    {
      "id": "007_UPDATE_EVENT",
      "name": "Update Event Time",
      "description": "Test the PUT endpoint to ensure updates don't break relations.",
      "method": "PUT",
      "endpoint": "?path=events/evt_ai_test_01",
      "payload": {
        "name": "Updated AI Assessment",
        "type": "type_ai_test",
        "date": "2025-12-02",
        "startTime": "11:30",
        "duration": 45,
        "clientIds": ["cl_test_ai_01"],
        "teamMemberIds": ["tm_test_ai_01"]
      },
      "assertions": [
        { "type": "statusCode", "value": 200 },
        { "type": "jsonProperty", "key": "success", "value": true }
      ]
    },
    {
      "id": "008_LOG_ACTIVITY",
      "name": "Verify Activity Logging",
      "description": "Manually trigger an activity log (simulating frontend behavior) and verify it saves.",
      "method": "POST",
      "endpoint": "?path=activities",
      "payload": {
        "user_id": "stefan",
        "user_name": "Stefan Admin",
        "action": "Test Automation",
        "details": "Running automated API tests",
        "action_type": "system_test"
      },
      "assertions": [
        { "type": "statusCode", "value": 200 },
        { "type": "jsonProperty", "key": "success", "value": true }
      ]
    },
    {
      "id": "009_INTERVENTION_PLAN",
      "name": "Create Intervention Plan",
      "description": "Test the dedicated intervention plan endpoint.",
      "method": "POST",
      "endpoint": "?path=intervention-plans",
      "payload": {
        "clientId": "cl_test_ai_01",
        "startDate": "2025-01-01",
        "endDate": "2025-06-01",
        "notes": "Automated Plan",
        "programIds": ["prog_1", "prog_3"]
      },
      "assertions": [
        { "type": "statusCode", "value": 200 },
        { "type": "jsonProperty", "key": "success", "value": true }
      ]
    },
    {
      "id": "010_CLEANUP_EVENT",
      "name": "Delete Test Event",
      "description": "Verify DELETE operation.",
      "method": "DELETE",
      "endpoint": "?path=events/evt_ai_test_01",
      "assertions": [
        { "type": "statusCode", "value": 200 },
        { "type": "jsonProperty", "key": "success", "value": true }
      ]
    },
    {
      "id": "011_CLEANUP_CLIENT",
      "name": "Delete Test Client",
      "description": "Cleanup client record.",
      "method": "DELETE",
      "endpoint": "?path=clients/cl_test_ai_01",
      "assertions": [
        { "type": "statusCode", "value": 200 },
        { "type": "jsonProperty", "key": "success", "value": true }
      ]
    },
    {
      "id": "012_CLEANUP_TEAM",
      "name": "Delete Test Therapist",
      "description": "Cleanup team member.",
      "method": "DELETE",
      "endpoint": "?path=team-members/tm_test_ai_01",
      "assertions": [
        { "type": "statusCode", "value": 200 },
        { "type": "jsonProperty", "key": "success", "value": true }
      ]
    }
  ]
}